<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TP — Jakarta Messaging (JMS) avec Apache ActiveMQ Artemis</title>
<style>
  :root{
    --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --muted:#9ca3af;
    --accent:#38bdf8; --accent2:#a78bfa; --ok:#22c55e; --warn:#f59e0b;
    --code-bg:#0b1222; --code-border:rgba(148,163,184,.25); --border:rgba(148,163,184,.2);
  }
  [data-theme="light"]{
    --bg:#f7fafc; --card:#fff; --ink:#0f172a; --muted:#4b5563;
    --accent:#2563eb; --accent2:#7c3aed; --ok:#16a34a; --warn:#d97706;
    --code-bg:#f3f4f6; --code-border:#e5e7eb; --border:#e5e7eb;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:980px;margin:28px auto;padding:0 16px}
  header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px}
  .title{font-size:28px;font-weight:700}
  .toolbar .btn{background:transparent;border:1px solid var(--accent2);color:var(--accent2);padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn:hover{background:rgba(99,102,241,.1)}
  section.card{background:rgba(17,24,39,.7);border:1px solid var(--border);backdrop-filter: blur(6px); padding:18px;border-radius:16px;margin:14px 0}
  [data-theme="light"] section.card{background:var(--card)}
  h2{font-size:20px;margin:0 0 6px 0}
  p,li{font-size:16px}
  details{border:1px dashed var(--border);border-radius:12px;padding:10px 12px;margin-top:10px}
  summary{cursor:pointer;font-weight:600;color:var(--accent)}
  details[open] summary{color:var(--accent2)}
  code,pre{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
  .ide{border:1px solid var(--code-border);border-radius:12px;overflow:hidden;background:var(--code-bg);margin-top:8px}
  .ide__topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--code-border)}
  .btn--tiny{padding:6px 10px;border-radius:8px;font-size:13px;border:1px solid var(--accent2);color:var(--accent2);background:transparent;cursor:pointer}
  pre{margin:0;padding:14px;overflow:auto}
  a{color:var(--accent2);text-decoration:none} a:hover{text-decoration:underline}
  .muted{color:var(--muted);font-size:14px}
  ul.tight>li{margin:4px 0}
</style>
</head>
<body>
<div class="wrap" id="app">
  <header>
    <div>
      <div class="title">TP — Jakarta Messaging (JMS) avec Apache ActiveMQ Artemis</div>
      <div class="muted">Files (Queues), Topics, JMSContext, Selectors, ACK, Transactions, DLQ</div>
    </div>
    <div class="toolbar">
      <button id="themeToggle" class="btn">Thème : Auto</button>
    </div>
  </header>

  <section class="card">
    <h2>Objectifs</h2>
    <ul class="tight">
      <li>Se connecter à un broker Apache Artemis et envoyer/recevoir des messages via <strong>JMSContext</strong>.</li>
      <li>Comprendre <strong>Queue</strong> (point-à-point) et <strong>Topic</strong> (publish/subscribe).</li>
      <li>Expérimenter <strong>ACK</strong>, <strong>transactions</strong> et <strong>DLQ</strong>.</li>
    </ul>
  </section>

  <section class="card">
    <h2>Prérequis & Démarrage</h2>
    <p>Cloner/générer le starter et lancer un premier test :</p>
    <div class="ide">
      <div class="ide__topbar">
        <span>Commandes</span>
        <button class="btn--tiny" id="copyCmd">Copier</button>
      </div>
      <pre><code id="cmdText">mvn clean package
mvn -Dexec.mainClass="com.example.jmsdemo.ConsumerApp" -DBROKER_URL="tcp://HOST:443" exec:java
# dans un second terminal :
mvn -Dexec.mainClass="com.example.jmsdemo.ProducerApp" -DBROKER_URL="tcp://HOST:443" -Dexec.args="5" exec:java</code></pre>
    </div>
    <p class="muted">Remplacez <code>HOST</code> par le DNS ou l'IP du broker Artemis configuré par l'enseignant.</p>
  </section>

  <section class="card">
    <h2>Exercice 1 — Producteur & Consommateur</h2>
    <p>Envoyer un JSON “commande” depuis le producteur, le consommer et afficher un traitement simulé.</p>
    <details>
      <summary>Indice</summary>
      <div>Utiliser <code>JMSContext</code>, <code>createQueue</code>, <code>createProducer().send(...)</code> et <code>receiveBody(String.class)</code>.</div>
    </details>
  </section>

  <section class="card">
    <h2>Exercice 2 — ACK & Transactions</h2>
    <p>Comparer <code>AUTO_ACKNOWLEDGE</code>, <code>CLIENT_ACKNOWLEDGE</code> et <code>SESSION_TRANSACTED</code> (commit/rollback).</p>
    <details>
      <summary>Indice</summary>
      <div>ACK manuel : <code>msg.acknowledge()</code>. Transactionnel côté producteur : <code>createContext(JMSContext.SESSION_TRANSACTED)</code> + <code>commit()</code>.</div>
    </details>
  </section>

  <section class="card">
    <h2>Exercice 3 — DLQ & Erreurs</h2>
    <p>Simuler une erreur de traitement (exception) et observer les re-livraisons puis l’envoi en DLQ selon la politique du broker.</p>
    <details>
      <summary>Indice</summary>
      <div>Lever une exception après réception. Sans ACK/commit, le message est re-livré puis routé vers la DLQ (config côté Artemis).</div>
    </details>
  </section>

  <section class="card">
    <h2>(Bonus) Exercice 4 — Topic & Abonnements durables</h2>
    <p>Lancer deux abonnés durables sur un Topic et publier un message : les deux doivent le recevoir.</p>
    <details>
      <summary>Indice</summary>
      <div>Abonné durable : <code>setClientID</code> + <code>createDurableConsumer(topic, "subName")</code>.</div>
    </details>
  </section>

  <p class="muted">Ressources utiles : Jakarta Messaging Spec, Artemis docs. Pensez à vérifier le pare-feu si la connexion échoue.</p>
</div>

<script>
(function(){
  // Theme auto + toggle
  const key='theme-preference';
  const saved=localStorage.getItem(key);
  const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches;
  const initial=saved|| (prefersDark?'dark':'light');
  document.documentElement.setAttribute('data-theme', initial);
  const btn=document.getElementById('themeToggle');
  function label(m){ btn.textContent = 'Thème : ' + (m==='dark'?'Sombre':'Clair'); }
  label(initial);
  btn.addEventListener('click', ()=>{
    const cur=document.documentElement.getAttribute('data-theme');
    const next=cur==='light'?'dark':'light';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem(key,next); label(next);
  });

  // Copier les commandes
  const copyBtn=document.getElementById('copyCmd');
  const code=document.getElementById('cmdText');
  copyBtn?.addEventListener('click', async ()=>{
    try{ await navigator.clipboard.writeText(code.innerText); copyBtn.textContent='Copié'; setTimeout(()=>copyBtn.textContent='Copier',1200); }
    catch(e){ alert('Copie non supportée'); }
  });
})();
</script>
</body>
</html>
